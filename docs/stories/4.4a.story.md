# Story 4.4a: Basic Split-Screen Review Layout

## Status
Pending

## Story
**As an accountant,**
**I want a split-screen interface for reviewing sales reports,**
**so that I can see reports and supporting documents simultaneously.**

## Acceptance Criteria
1. Split-screen layout showing sales report and linked supporting documents
2. Review status indicators (pending, approved, rejected) with visual feedback

## Tasks / Subtasks
- [ ] Create split-screen review component layout (AC: 1)
  - [ ] Build SalesReportReview component with two-panel layout using CSS Grid
  - [ ] Implement left panel for sales report details with outlet, date, amounts
  - [ ] Implement right panel for supporting document viewer with preview capability
  - [ ] Add responsive design for mobile and tablet screen sizes
  - [ ] Use shadcn/ui components for consistent styling and accessibility
- [ ] Implement document viewer integration (AC: 1)
  - [ ] Integrate with existing Document Management Service for document retrieval
  - [ ] Add document preview functionality for images and PDFs
  - [ ] Implement document navigation for multiple supporting documents
  - [ ] Add document zoom and view controls for detailed review
  - [ ] Handle document loading states and error scenarios
- [ ] Add review status indicators and controls (AC: 2)
  - [ ] Create status badge components for pending, approved, rejected states
  - [ ] Add visual feedback with color coding and icons for each status
  - [ ] Implement status change indicators with transitions
  - [ ] Add review action buttons (approve, reject) with confirmation dialogs
  - [ ] Display review history and status change timeline
- [ ] Create protected route for accountants (AC: 1, 2)
  - [ ] Set up `/dashboard/sales-reports/review/[id]` route with accountant role protection
  - [ ] Add navigation link in accountant dashboard for report queue access
  - [ ] Implement route middleware for role-based access control
  - [ ] Add breadcrumb navigation with report context information
- [ ] Add comprehensive component testing (Testing requirement)
  - [ ] Create unit tests for SalesReportReview component layout and interactions
  - [ ] Test split-screen responsive behavior across different screen sizes
  - [ ] Test document viewer integration and navigation functionality
  - [ ] Test status indicators and visual feedback changes
  - [ ] Test role-based access control and route protection

## Dev Notes

### Previous Story Insights
From Story 4.2 Manager Sales Report Upload Interface completion:
- Sales report submission form is fully implemented with proper validation
- Document attachment capability integrated with Document Management Service
- Server actions established for sales report operations and outlet management
- Protected routes implemented with role-based access control patterns
- Comprehensive testing infrastructure ready for component validation

### Tech Stack Requirements
[Source: architecture/tech-stack.md]
- Frontend Framework: Next.js v14+ App Router for review routing and Server Components integration
- UI Component Library: shadcn/ui v4 for professional split-screen layout and status indicators
- State Management: Zustand v4.4+ for review state and document viewer state management
- File Storage: Vercel Blob for document preview and secure document access
- Frontend Testing: Jest + Testing Library v29+/13+ for component and interaction testing

### Component Architecture Requirements
[Source: architecture/frontend-architecture.md and components.md]
**Review Component Location**: `src/components/reviews/` directory for business review components
**Layout Pattern**: CSS Grid for split-screen layout with responsive breakpoints
**State Management**: React Query for server state, Zustand for UI state, useState for component-specific state
**Document Integration**: Existing Document Management Service for secure document access

### Sales Report Workflow Service Integration
[Source: architecture/components.md#sales-report-workflow-service]
**Key Interfaces to Implement**:
- `getReportsForReview(accountantId)` - Pending reports queue with supporting documents
- `approveReport(reportId, comments)` - Accountant approval with notification to manager
- `rejectReport(reportId, corrections)` - Rejection with specific correction requirements
**Dependencies**: Document Management Service (supporting files), Authentication Service (role verification), Notification Service
**Technology Stack**: shadcn/ui for split-screen review interface, Server Actions for review actions

### Document Management Service Integration
[Source: architecture/components.md#document-management-service]
**Required Integration**:
- `generatePreviewUrl(docId)` - Secure document preview URLs for supporting documents
- `linkDocumentToEntity(docId, reportId, 'SALES_REPORT')` - Retrieve linked documents for reports
- Document viewer must handle multiple file types (images, PDFs) with appropriate preview controls
- Secure document access with proper authentication and authorization

### Data Model Integration
[Source: types/sales-report.ts from previous stories]
**SalesReport Model Usage**:
```typescript
interface SalesReport {
  id: string;
  outletId: string;
  date: Date;
  cashDeposits: number;
  cardSettlements: number;
  totalSales: number;
  submittedById: string;
  status: SalesReportStatus; // PENDING, APPROVED, REJECTED
  createdAt: Date;
  updatedAt: Date;
  // Relationships
  outlet: Outlet;
  submittedBy: User;
  documents: Document[]; // Supporting documents for review
}
```

**Status Enum Usage**:
```typescript
enum SalesReportStatus {
  DRAFT = 'DRAFT',
  SUBMITTED = 'SUBMITTED',
  APPROVED = 'APPROVED',
  REJECTED = 'REJECTED'
}
```

### Split-Screen Layout Requirements
**Layout Specifications**:
- Left panel: 50% width for sales report details (outlet, date, amounts, calculations)
- Right panel: 50% width for document viewer with controls
- Responsive breakpoints: Stack vertically on mobile (< 768px), side-by-side on desktop
- Panel resizing capability for user preference (optional enhancement)
- Proper accessibility with keyboard navigation and screen reader support

### Review Status Visual Design
**Status Indicators**:
- SUBMITTED/PENDING: Yellow/amber badge with clock icon
- APPROVED: Green badge with checkmark icon
- REJECTED: Red badge with X icon
- Include status change animations and transitions for better user experience
- Display submission date, review date, and reviewer information

### File Locations
[Source: architecture/unified-project-structure.md]
- Review Component: `src/components/reviews/SalesReportReview.tsx` (new file)
- Document Viewer: `src/components/documents/DocumentViewer.tsx` (enhance existing or create)
- Server Actions: `app/actions/review-actions.ts` (new file)
- Route Page: `app/dashboard/sales-reports/review/[id]/page.tsx` (new file)
- Type Definitions: Use existing `types/sales-report.ts` from previous stories
- Test Files: `src/__tests__/components/SalesReportReview.test.tsx` (new file)

### Coding Standards
[Source: architecture/coding-standards.md]
- **Component Naming**: Use PascalCase for `SalesReportReview.tsx`, `DocumentViewer.tsx`
- **API Routes**: Use kebab-case for `/dashboard/sales-reports/review/[id]` route
- **Type Sharing**: Import types from existing types directory for consistent interfaces
- **Error Handling**: All review actions must use standard error handling patterns
- **State Updates**: Use proper state management patterns, never mutate state directly

### Authentication and Role-Based Access
[Source: architecture/components.md#authentication-service]
**Required Role Validation**:
- Route must be protected with `requireRole('ACCOUNTANT')` middleware
- User session must contain role permissions for sales report review
- Review actions must validate user has accountant permissions
- Document access must be secured through proper authentication

### Database Integration Requirements
**Required Database Operations**:
- Retrieve sales report with related outlet, submitter, and document information
- Update report status (SUBMITTED -> APPROVED/REJECTED) with audit trail
- Log review actions with timestamp and reviewer ID for compliance
- Retrieve supporting documents with secure access control

### Project Structure Notes
Review component integrates with existing Next.js App Router structure. Document viewer leverages existing Vercel Blob integration. Server Actions follow established patterns for review processing. Route protection uses established NextAuth.js middleware patterns. Component testing follows existing Jest + Testing Library patterns from previous stories.

## Testing
[Source: architecture/testing-strategy.md]
- **Frontend Unit Testing**: Jest + Testing Library v29+/13+ for review component validation and user interactions
- **Test Locations**:
  - `src/__tests__/components/SalesReportReview.test.tsx` - Split-screen layout, status indicators, and review interactions
  - `src/__tests__/components/DocumentViewer.test.tsx` - Document viewer functionality and navigation
- **Testing Scenarios**:
  - Split-screen layout rendering with proper content distribution
  - Responsive behavior on different screen sizes (mobile, tablet, desktop)
  - Document viewer integration with multiple file types and navigation
  - Status indicator display and visual feedback for different review states
  - Review action buttons functionality and confirmation dialogs
  - Role-based access control and route protection for accountants
  - Server action integration for approve/reject operations
  - Document loading states, error handling, and security access

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-17 | 1.0 | Initial story creation for basic split-screen review layout | Claude Code |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 (claude-sonnet-4-20250514) - Full Stack Developer Agent

### Implementation Status
**PENDING** - Story ready for development

### Completion Notes
*This section will be populated during implementation*

### File List
*This section will be populated during implementation*

### Debug Log References
*This section will be populated during implementation*

## QA Results

*This section will be populated by the QA agent during review*